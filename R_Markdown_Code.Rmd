```{r}
library(tidyverse)
data <- read.csv("kc_house_data.csv")
data
```
Jett's Data Cleaning:
```{r}
non_renovated_data <- data[data$yr_renovated == 0, ]
renovated_data <- data[data$yr_renovated != 0, ]
```

```{r}
invalid_renovation_data <- data[data$yr_renovated != 0 & data$yr_renovated < data$yr_built, ]
```

```{r}
library(ggplot2)

ggplot(data, aes(x = sqft_living, y = price)) +
  geom_point(alpha = 0.4) +
  labs(
    title = "Scatter Plot: Price vs. Living Area",
    x = "Living Area (sqft)",
    y = "Price"
  )
```
```{r}
ggplot(data, aes(x = as.factor(condition), y = price)) +
  geom_boxplot() +
  labs(
    title = "Box Plot: Price by Condition",
    x = "Condition",
    y = "Price"
  )
```

```{r}
ggplot(data, aes(x = as.factor(condition), y = price)) +
  geom_boxplot() +
  scale_y_log10() +
  labs(
    title = "Box Plot: Price by Condition",
    x = "Condition",
    y = "Price (Log)"
  )
```

Zoha Data Visualizations:
```{r}
ggplot(data, aes(x=sqft_living, y=price, color=sqft_living)) +
                 facet_wrap(~waterfront) +
                 geom_point() + 
                 labs(title = "Price of House based on sqft living and waterfront view",
                        x="Square foot living space",
                        y="Price")+ 
                theme(plot.title = element_text(hjust = 0.5))
```
**(2) Price of median sqft living **
```{r}
Data<-data%>%
  mutate(house_size=case_when(sqft_living <= 2000 ~ "small",
  sqft_living > 2000 & sqft_living <=5000 ~ "medium",
  sqft_living > 5000 ~ "large"))

medianPrice<-Data %>% 
  group_by(house_size) %>% 
  summarize(median_price=median(price)) 

ggplot(medianPrice, aes(x=house_size, y=median_price))+
  geom_bar(fill="#90e7fc", stat='identity')+
  theme(plot.title = element_text(hjust=0.5),
        axis.text.x = element_text(angle = 90))+
  labs(x="Square foot living", y="Median Price of House",
  title="Price of House by Sq Ft")
```

**(3) Price and grade **

```{r}
ggplot(Data, aes(x=grade, y=price, color=grade)) +
                 geom_point() + 
                 labs(title = "House Price based on Grade",
                        x="Grade",
                        y="Price") + 
                theme(plot.title = element_text(hjust = 0.5))
```
**(3) Price and grade boxcox plot**

```{r}
ggplot(Data, aes(x= as.factor(grade), y=price))+ 
  geom_boxplot()+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Grade", y="Price", title="Price of House across Grade")
```
Jett's LM, forward, backward and stepwise elimination:
```{r}
#I removed time due to the difficulties in working with it in a linear regression model, and I took out sqft living as it is just the sum of sqft above and sqft basement and is therefore redundant
result <- lm(price ~ . - date - sqft_living - id, data = data)
summary(result)
```
```{r}
regnull <- lm(price~1, data=data)
regfull <- result
step(regfull, scope=list(lower=regnull, upper=regfull), direction="backward")
```
```{r}
step(regnull, scope=list(lower=regnull, upper=regfull), direction="forward")
```
```{r}
step(regnull, scope=list(lower=regnull, upper=regfull), direction="both")
```
Jett regression assumptions check:
```{r}
par(mfrow = c(2, 2))
plot(result)
```
```{r}
library(MASS)
MASS::boxcox(result)
```

```{r}
#data$y.star<-log(data$price)
#result.ystar<-lm(y.star~.- date - sqft_living - id, data=data)
#par(mfrow = c(2, 2))
#plot(result.ystar)
```
Jett, Checking for multicollinearity:
```{r}
library(faraway)
round(faraway::vif(result),3)
```
No variables have a VIF of above 5, meaning this test does not indicate multicolinearity. sqftabove however has a 4.923 which is close enough to look into!

Jett, Trying out potential other model:
```{r}
reduced <- lm(price ~ . - id - sqft_basement - date, data = data)
reduced
```
```{r}
par(mfrow = c(2, 2))
plot(reduced)
```
```{r}
library(faraway)
round(faraway::vif(reduced),3)
```

Jett, ANOVA test comparison
```{r}
anova(reduced, result)
```
This supports the full model over the reduced model










Zoha Linear Regression
```{r}
# I originally fit the mlr with all variables but each date was being treated as a separate predictor so I removed it along with ID since thats not a predictor
result2 <- lm(price ~ . - date - id, data = data)
summary(result2)
```
Zoha - Model Selection
```{r}
#added a 2 to the end of the variable so it didn't conflict with the above code
##intercept only model
regnull2 <- lm(price ~1 -date -id, data = data)
##model with all predictors
regfull2 <- lm(price ~. -date -id, data = data)

```

# Forward selection
```{r}
step(regnull2, scope=list(lower=regnull2, upper=regfull2), direction="forward")
```
# Backward Selection
```{r}
step(regfull2, scope=list(lower=regnull2, upper=regfull2), direction="backward")
```


# Both directions
```{r}
step(regnull2, scope=list(lower=regnull2, upper=regfull2), direction="both")
```
Zoha Regression assumptions
```{r}
par(mfrow = c(2, 2))
plot(result2)
```
```{r}
library(MASS)
MASS::boxcox(result2)
```
Multicollinearity Check:
```{r}
library(faraway)
all <- lm(price ~ . - date - sqft_living - id, data = data)
round(faraway::vif(all),2)
```

Since these values are all below 5, they don't show multicollinearity.

Katherine's Model
```{r}
#Check correlations
round(cor(data),3)
```

```{r}
#First model based on correlations (not very good adjusted R-squared value of 0.5741.)
result<-lm(price~sqft_living+grade+bathrooms+view, data=data)
summary(result)

#Full Model with adj R-squared of ~0.7
result_full<-lm(price~., data=data)
summary(result_full)

library(faraway)
faraway::vif(result_full)

```

```{r}
#forward, backward, and stepwise selection

##intercept only model
regnull <- lm(price~1, data=data)
##model with all predictors
regfull <- lm(price~., data=data)

##### Forward selection
step(regnull, scope=list(lower=regnull, upper=regfull), direction="forward")

#Forward selected model:  0.7 adj r-squared

fwd_selected = lm(price ~ -id - date + sqft_living + lat + view + grade + yr_built + waterfront + bedrooms + bathrooms + zipcode + long + condition + sqft_above + sqft_living15 + yr_renovated + sqft_lot15 + sqft_lot + floors, data = data)
summary(fwd_selected)

fwd_selected = lm(price ~ -id - date + sqft_living + lat + view + grade + yr_built + waterfront + bedrooms + bathrooms + zipcode + long + condition - sqft_above - sqft_living15 + yr_renovated + sqft_lot15 + sqft_lot + floors, data = data)
summary(fwd_selected)

##### backward regression
step(regfull, scope=list(lower=regnull, upper=regfull), direction="backward")

##### stepwise regression
step(regnull, scope=list(lower=regnull, upper=regfull), direction="both")
stepwise_reg = lm(formula = price ~ -id - date + sqft_living + lat + view + grade + yr_built + waterfront + bedrooms + bathrooms + zipcode + long + condition + sqft_above + sqft_living15 + yr_renovated + sqft_lot15 + sqft_lot + floors, data = data)

faraway::vif(stepwise_reg)
#VIF values high for sqft_above, sqft_lot15, sqft_living, so removed sqft_above

#stepwise regression minus correlated variables
step(regnull, scope=list(lower=regnull, upper=regfull), direction="both")

stepwise_reg2 = lm(formula = price ~ -id - date + sqft_living + lat + view + grade + yr_built + waterfront + bedrooms + bathrooms + zipcode + long + condition - sqft_above + sqft_living15 + yr_renovated + sqft_lot15 + sqft_lot + floors, data = data)

#VIF values better
faraway::vif(stepwise_reg2)


summary(stepwise_reg2)

par(mfrow = c(2, 2))
plot(stepwise_reg2)

```
